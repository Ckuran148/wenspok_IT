<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jolt Dashboard</title>
    <link rel="stylesheet" href="jolt_styles.css">
</head>
<body>

<div class="app-container">
    <header>
        <h1>Jolt Operations Dashboard</h1>
    </header>

    <div class="tabs">
        <button class="tab-btn active" onclick="switchTab('inspector')">List Inspector</button>
        <button class="tab-btn" onclick="switchTab('grid')">DFSL Overview</button>
        <button class="tab-btn" onclick="switchTab('report')">DFSL Report View</button>
        <button class="tab-btn" onclick="switchTab('audits')">Safety Audits</button>
    </div>

    <!-- VIEW 1: INSPECTOR -->
    <div id="tab-inspector" class="view-content active">
        <div class="legend-box">
            <strong>Legend:</strong>
            <span class="legend-item">üõ°Ô∏è Integrity Score</span>
            <span class="legend-item">‚è±Ô∏è Duration</span>
            <span class="legend-item"><span style="color:red">üî¥</span> Expired</span>
            <span class="legend-item"><span style="color:orange">üü†</span> Expiring Soon (7 Days)</span>
            <span class="legend-item"><span style="color:gold">üü°</span> Expiring Today</span>
        </div>
        
        <div class="controls-bar">
            <div class="control-group">
                <label>Location</label>
                <select id="locationSelect">
                    <option value="">Loading...</option>
                </select>
            </div>
            <div class="control-group">
                <label>Start Date</label>
                <input type="date" id="startDate">
            </div>
            <div class="control-group">
                <label>End Date</label>
                <input type="date" id="endDate">
            </div>
            <button class="btn-primary" onclick="fetchChecklists()">View Checklists</button>
            
            <div class="action-group">
                <button class="btn-secondary" onclick="exportCurrentView()">Export View</button>
                <button class="btn-secondary" onclick="exportAllLocations()">Export All Sites</button>
            </div>
        </div>

        <div class="main-content">
            <div class="sidebar" id="listSidebar">
                <div style="padding: 20px; color: #666; text-align: center;">
                    Select a location and date to load lists.
                </div>
            </div>
            <div class="detail-view" id="detailView">
                <div style="text-align: center; color: #999; margin-top: 50px;">
                    <h3>Select a list to view contents</h3>
                    <p>Items and sub-lists will appear here.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- VIEW 2: DFSL OVERVIEW (GRID) -->
    <div id="tab-grid" class="view-content">
        <div class="controls-bar">
            <div class="control-group">
                <label>Date</label>
                <input type="date" id="gridDate">
            </div>
            <button class="btn-primary" onclick="loadStoreGrid()">Load Store Grid</button>
            <div class="action-group">
                <button class="btn-secondary" onclick="exportGridToCSV()">Export Grid CSV</button>
            </div>
        </div>
        
        <div class="grid-container">
            <table class="store-grid" id="storeTable">
                <thead>
                    <tr>
                        <th>Store Name</th>
                        <th>Daypart 1 (DFSL/FSL)</th>
                        <th>Daypart 3 (DFSL/FSL)</th>
                        <th>Daypart 5 (DFSL/FSL)</th>
                        <th>Sanitizer Issues</th>
                    </tr>
                </thead>
                <tbody>
                    <tr><td colspan="5" style="text-align:center; padding:30px;">Click "Load Store Grid" to generate report.</td></tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- VIEW 3: DFSL REPORT VIEW -->
    <div id="tab-report" class="view-content">
        <div class="controls-bar no-print">
            <div class="control-group">
                <label>Location</label>
                <select id="reportLocationSelect">
                    <option value="">Loading...</option>
                </select>
            </div>
            <div class="control-group">
                <label>Date</label>
                <input type="date" id="reportDate">
            </div>
            <button class="btn-primary" onclick="generateSingleReport()">Generate Report</button>
            <div class="action-group">
                <button class="btn-secondary" onclick="window.print()">Download PDF</button>
            </div>
        </div>

        <div class="report-container">
            <div class="report-page" id="reportContent">
                <div style="text-align:center; padding-top:50px; color:#666;">
                    Select Location & Date above, then click Generate.
                </div>
            </div>
        </div>
    </div>

    <!-- VIEW 4: SAFETY AUDITS (NEW) -->
    <div id="tab-audits" class="view-content">
        <div class="controls-bar no-print">
            <div class="control-group">
                <label>Location</label>
                <select id="auditLocationSelect">
                    <option value="">Loading...</option>
                </select>
            </div>
            <div class="control-group">
                <label>Month</label>
                <input type="month" id="auditMonth">
            </div>
            <button class="btn-primary" onclick="fetchAudits()">View Audits</button>
            
            <div class="action-group">
                <button class="btn-secondary" onclick="window.print()">üñ®Ô∏è Print Audit</button>
            </div>
        </div>

        <div class="main-content">
            <div class="sidebar" id="auditSidebar">
                <div style="padding: 20px; color: #666; text-align: center;">
                    Select location & month to load audits.
                </div>
            </div>
            <div class="detail-view" id="auditDetailView">
                <div style="text-align: center; color: #999; margin-top: 50px;">
                    <h3>Select an audit to view contents</h3>
                </div>
            </div>
        </div>
    </div>

</div>

<!-- Photo Modal -->
<div id="photoModal">
    <div class="photo-content">
        <button class="close-photo" onclick="closePhoto()">Close</button>
        <h3 id="photoTitle">Photo Details</h3>
        <div class="photo-placeholder">
            <span>Image Preview Unavailable via API</span>
        </div>
        <p id="photoCaption" style="font-family:monospace; color:#333; word-break:break-all;"></p>
    </div>
</div>

<!-- Loading Overlay -->
<div id="loadingOverlay">
    <div class="loader"></div>
    <h2 id="loadingText">Processing...</h2>
    <p id="loadingSubtext">Please wait.</p>
</div>

<!-- Debug Log (Hidden) -->
<div id="system-log" style="display:none;"></div>

<!-- Configuration Modal (Hidden) -->
<div id="configModal">
    <div class="modal-content">
        <h3>API Connection Settings</h3>
        <p style="font-size: 0.8rem; color: #666;">Adjust these only if connection fails.</p>
        <div class="modal-row">
            <label>Proxy URL (Worker)</label>
            <input type="text" id="cfg-url" value="https://jolt-proxy.ckuran.workers.dev">
        </div>
        <div class="modal-row" style="opacity: 0.5;">
            <label>Auth Token (Managed by Worker)</label>
            <input type="text" id="cfg-token-val" placeholder="(Hidden)" disabled>
        </div>
        <div style="text-align: right; margin-top: 15px;">
            <button onclick="saveConfig()" class="btn-primary">Save & Reload</button>
            <button onclick="document.getElementById('configModal').style.display='none'" style="padding: 9px;">Cancel</button>
        </div>
    </div>
</div>

<script src="jolt_logic.js"></script>

</body>
</html>
